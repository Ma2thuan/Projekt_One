@model IEnumerable<Projekt_1.Model.passbook>

@{
    ViewBag.Title = "Passbooks";
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}

<h2 class="mb-4"></h2>

<div class="search-form">
    @using (Html.BeginForm("Search", "passbooks", FormMethod.Get, new { id = "searchForm" }))
    {
        <div class="row">
            <div class="col-md-4">
                <div class="form-group">
                    <label for="savingsBookID">Savings Book ID</label>
                    <input type="number" name="savingsBookID" class="form-control" id="savingsBookID"
                           value="@ViewBag.SavingsBookID" placeholder="Enter Savings Book ID" />
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="initialDepositAmount">Initial Deposit Amount</label>
                    <input type="number" name="initialDepositAmount" class="form-control" id="initialDepositAmount"
                           value="@ViewBag.InitialDepositAmount" placeholder="Enter max deposit amount" />
                </div>
            </div>
            <div class="col-md-4">
                <div class="form-group">
                    <label for="term">Search Term</label>
                    <input type="text" name="term" class="form-control" id="term"
                           value="@ViewBag.Term" placeholder="Search by term" />
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-start gap-2 mt-3">
            <button type="submit" class="btn btn-primary">Search</button>
            <a href="@Url.Action("Index", "passbooks")" id="resetButton" class="btn btn-secondary">Reset</a>
        </div>
    }
</div>

<p class="mt-4">
    @Html.ActionLink("Create New", "Create", null, new { @class = "btn btn-success" })
</p>

<div class="table-container">
    <table class="table table-hover table-bordered mt-4" id="resultsTable">
        <thead class="table-dark">
            <tr>
                <th>Savings Book ID</th>
                <th>Initial Deposit</th>
                <th>Deposit Amount</th>
                <th>Interest Rate (%)</th>
                <th>Closed</th>
                <th>Account Type</th>
                <th>User Name</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                foreach (var item in Model)
                {
                    <tr>
                        <td>@Html.DisplayFor(modelItem => item.SavingsBookID)</td>
                        <td>@Html.DisplayFor(modelItem => item.InitialDepositAmount)</td>
                        <td>@Html.DisplayFor(modelItem => item.DepositAmount)</td>
                        <td>@Html.DisplayFor(modelItem => item.InterestRate)</td>
                        <td>@Html.DisplayFor(modelItem => item.IsClosed)</td>
                        <td>@Html.DisplayFor(modelItem => item.SavingsAccountType.AccountTypeName)</td>
                        <td>@Html.DisplayFor(modelItem => item.user.user_name)</td>
                        <td class="d-flex gap-2">
                            @Html.ActionLink("Edit", "Edit", new { id = item.SavingsBookID }, new { @class = "btn btn-warning btn-sm" })
                            @Html.ActionLink("Details", "Details", new { id = item.SavingsBookID }, new { @class = "btn btn-info btn-sm" })
                            @Html.ActionLink("Delete", "Delete", new { id = item.SavingsBookID }, new { @class = "btn btn-danger btn-sm" })
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="8" class="text-center text-muted">No records found.</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Handle Search Form Submission
            $('#searchForm').on('submit', function (e) {
                e.preventDefault(); // Prevent default form submission

                $.ajax({
                    url: $(this).attr('action'), // Get the form's action URL
                    type: $(this).attr('method'), // Get the form's method
                    data: $(this).serialize(), // Serialize form data
                    success: function (response) {
                        // Replace the entire table content with the new response
                        $('#resultsTable').html($(response).find('#resultsTable').html());
                    },
                    error: function () {
                        alert('An error occurred while processing your request.');
                    }
                });
            });

            // Handle Reset Button Click
            $('#resetButton').on('click', function (e) {
                e.preventDefault(); // Prevent default link action

                $.ajax({
                    url: '@Url.Action("Index", "passbooks")', // Reload the initial Index view
                    type: 'GET',
                    success: function (response) {
                        // Replace the table content and reset search form fields
                        $('#resultsTable').html($(response).find('#resultsTable').html());
                        $('#searchForm')[0].reset();
                    },
                    error: function () {
                        alert('An error occurred while processing your request.');
                    }
                });
            });
        });
    </script>
}